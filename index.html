<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ChatKit script (OpenAI) -->
    <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" async></script>
    <!-- ↑ źródło: docs ChatKit Quickstart / guide -->
    <title>ChatKit na Netlify</title>

    <style>
      html, body { height: 100%; margin: 0; }
      openai-chatkit { display: block; height: 100vh; }
    </style>
  </head>

  <body>
    <openai-chatkit id="my-chat"></openai-chatkit>

    <script>
      function getOrCreateUserId() {
        const key = "chatkit_user_id";
        let id = localStorage.getItem(key);
        if (!id) {
          id = "user_" + Math.random().toString(16).slice(2) + "_" + Date.now();
          localStorage.setItem(key, id);
        }
        return id;
      }

      const userId = getOrCreateUserId();

      // ======= TWOJA KONFIGURACJA Z KREATORA (przerobiona na JS) =======
      const options = {
        api: {
          // Najprościej: zawsze prosimy backend Netlify o nowy client_secret.
          // ChatKit sam wywoła tę funkcję, gdy będzie potrzebował tokenu.
          async getClientSecret(currentClientSecret) {
            const res = await fetch("/.netlify/functions/chatkit-session", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                user: userId,
                currentClientSecret: currentClientSecret || null
              })
            });
            if (!res.ok) {
              const txt = await res.text();
              throw new Error("Nie udało się pobrać client_secret: " + txt);
            }
            const data = await res.json();
            return data.client_secret;
          }
        },

        // --- Poniżej: wklejone z kreatora (Twoje) ---
        theme: {
          colorScheme: "light",
          radius: "pill",
          density: "compact",
          typography: {
            baseSize: 14,
            fontFamily:
              '"OpenAI Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif',
            fontFamilyMono:
              'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "DejaVu Sans Mono", "Courier New", monospace',
            fontSources: [
              {
                family: "OpenAI Sans",
                src: "https://cdn.openai.com/common/fonts/openai-sans/v2/OpenAISans-Regular.woff2",
                weight: 400,
                style: "normal",
                display: "swap"
              }
              // Jeśli kreator dał więcej fontSources, dopisz je tutaj.
            ]
          }
        },

        composer: {
          attachments: {
            enabled: true,
            maxCount: 5,
            // maxSize jest w BAJTACH (u Ciebie: 10 MB) :contentReference[oaicite:2]{index=2}
            maxSize: 10485760
          },
          tools: [
            {
              id: "search_docs",
              label: "Search docs",
              shortLabel: "Docs",
              placeholderOverride: "Search documentation",
              icon: "circle-question",
              pinned: false
            }
            // Jeśli kreator dodał więcej tools, dopisz je tutaj.
          ]
        },

        startScreen: {
          greeting: "",
          prompts: [
            {
              icon: "circle-question",
              label: "Szybka analiza luk (gap assessment) pod NIS2",
              prompt: "Szybka analiza luk (gap assessment) pod NIS2"
            },
              {
              icon: "circle-question",
              label: "Plan wdrożenia / roadmapa (np. 30/60/90 dni albo 6–12 miesięcy)",
              prompt: "Plan wdrożenia / roadmapa (np. 30/60/90 dni albo 6–12 miesięcy)"
            },
              {
              icon: "circle-question",
              label: "Mapowanie wymagań NIS2 ↔ ISO 27001/27002 ↔ RODO ↔ ISO 22301",
              prompt: "Mapowanie wymagań NIS2 ↔ ISO 27001/27002 ↔ RODO ↔ ISO 22301"
            },
              {
              icon: "circle-question",
              label: "Checklisty dowodowe: jakie dokumenty i artefakty przygotować na audyt / kontrolę",
              prompt: "Checklisty dowodowe: jakie dokumenty i artefakty przygotować na audyt / kontrolę"
            },
                          {
              icon: "circle-question",
              label: "Dostawcy i łańcuch dostaw: wymagania, ocena ryzyka, klauzule i monitoring",
              prompt: "Dostawcy i łańcuch dostaw: wymagania, ocena ryzyka, klauzule i monitoring"
            },
            // Jeśli kreator dodał więcej prompts, dopisz je tutaj.
          ]
        }

        // Możesz tu też wkleić inne sekcje z kreatora (header, history, threadItemActions itd.).
      };
      // ================================================================

      async function mount() {
        // poczekaj aż web component będzie zdefiniowany
        await customElements.whenDefined("openai-chatkit");
        const chatkit = document.getElementById("my-chat");
        chatkit.addEventListener("chatkit.error", (e) => {
  console.error("CHATKIT ERROR:", e.detail?.error || e);
  alert("ChatKit error: " + (e.detail?.error?.message || "sprawdź Console"));
});

        
        chatkit.setOptions(options); // ChatKit konfiguruje się przez setOptions :contentReference[oaicite:3]{index=3}
      }

      mount().catch(console.error);
    </script>
  </body>
</html>
